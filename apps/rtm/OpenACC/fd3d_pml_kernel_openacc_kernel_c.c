//
// auto-generated by ops.py
//

#define OPS_GPU

int xdim0_fd3d_pml_kernel;
int ydim0_fd3d_pml_kernel;
int zdim0_fd3d_pml_kernel;
int xdim1_fd3d_pml_kernel;
int ydim1_fd3d_pml_kernel;
int zdim1_fd3d_pml_kernel;
int xdim2_fd3d_pml_kernel;
int ydim2_fd3d_pml_kernel;
int zdim2_fd3d_pml_kernel;
int xdim3_fd3d_pml_kernel;
int ydim3_fd3d_pml_kernel;
int zdim3_fd3d_pml_kernel;

//user function
inline 
void fd3d_pml_kernel(const ptr_float rho,
  const ptr_float mu,
  const ptrm_float  yy,
  ptrm_float  dy,
  const int *idx)
{
  float sigma = OPS_ACC(mu, 0,0,0)/OPS_ACC(rho, 0,0,0);
  float sigmax=0.0f;
  float sigmay=0.0f;
  float sigmaz=0.0f;

  if(idx[0]<=xbeg+pml_width){
    sigmax = (xbeg+pml_width-idx[0])*sigma/pml_width;
  }
  if(idx[0]>=xend-pml_width){
    sigmax=(idx[0]-(xend-pml_width))*sigma/pml_width;
  }
  if(idx[1]<=ybeg+pml_width){
    sigmay=(ybeg+pml_width-idx[1])*sigma/pml_width;
  }
  if(idx[1]>=yend-pml_width){
    sigmay=(idx[1]-(yend-pml_width))*sigma/pml_width;
  }
  if(idx[2]<=zbeg+pml_width){
    sigmaz=(zbeg+pml_width-idx[2])*sigma/pml_width;
  }
  if(idx[2]>=zend-pml_width){
    sigmaz=(idx[2]-(zend-pml_width))*sigma/pml_width;
  }





  float px = OPS_ACC(yy, 0,0,0,0);
  float py = OPS_ACC(yy, 1,0,0,0);
  float pz = OPS_ACC(yy, 2,0,0,0);

  float vx = OPS_ACC(yy, 3,0,0,0);
  float vy = OPS_ACC(yy, 4,0,0,0);
  float vz = OPS_ACC(yy, 5,0,0,0);

  float vxx=0.0f;
  float vyy=0.0f;
  float vzz=0.0f;

  float pxx=0.0f;
  float pxy=0.0f;
  float pxz=0.0f;

  float pyx=0.0f;
  float pyy=0.0f;
  float pyz=0.0f;

  float pzx=0.0f;
  float pzy=0.0f;
  float pzz=0.0f;

  for(int i=-halff;i<=halff;i++)
    {
#define CX
#ifndef CX
      pxx += OPS_ACC(yy, 0,i,0,0)*c[i]*invdx;
      pyx += OPS_ACC(yy, 1,i,0,0)*c[i]*invdx;
      pzx += OPS_ACC(yy, 2,i,0,0)*c[i]*invdx;
      vxx += OPS_ACC(yy, 3,i,0,0)*c[i]*invdx;

      pxy += OPS_ACC(yy, 0,0,i,0)*c[i]*invdy;
      pyy += OPS_ACC(yy, 1,0,i,0)*c[i]*invdy;
      pzy += OPS_ACC(yy, 2,0,i,0)*c[i]*invdy;
      vyy += OPS_ACC(yy, 4,0,i,0)*c[i]*invdy;

      pxz += OPS_ACC(yy, 0,0,0,i)*c[i]*invdz;
      pyz += OPS_ACC(yy, 1,0,0,i)*c[i]*invdz;
      pzz += OPS_ACC(yy, 2,0,0,i)*c[i]*invdz;
      vzz += OPS_ACC(yy, 5,0,0,i)*c[i]*invdz;

#else
      int j = i+halff;
      pxx += OPS_ACC(yy, 0,i,0,0)*cx[j];
      pyx += OPS_ACC(yy, 1,i,0,0)*cx[j];
      pzx += OPS_ACC(yy, 2,i,0,0)*cx[j];
      vxx += OPS_ACC(yy, 3,i,0,0)*cx[j];

      pxy += OPS_ACC(yy, 0,0,i,0)*cy[j];
      pyy += OPS_ACC(yy, 1,0,i,0)*cy[j];
      pzy += OPS_ACC(yy, 2,0,i,0)*cy[j];
      vyy += OPS_ACC(yy, 4,0,i,0)*cy[j];

      pxz += OPS_ACC(yy, 0,0,0,i)*cz[j];
      pyz += OPS_ACC(yy, 1,0,0,i)*cz[j];
      pzz += OPS_ACC(yy, 2,0,0,i)*cz[j];
      vzz += OPS_ACC(yy, 5,0,0,i)*cz[j];
#endif
    }

  OPS_ACC(dy, 0,0,0,0)=vxx/OPS_ACC(rho, 0,0,0) - sigmax*px;
  OPS_ACC(dy, 1,0,0,0)=vyy/OPS_ACC(rho, 0,0,0) - sigmay*py;
  OPS_ACC(dy, 2,0,0,0)=vzz/OPS_ACC(rho, 0,0,0) - sigmaz*pz;

  OPS_ACC(dy, 3,0,0,0)=(pxx+pyx+pzx)*OPS_ACC(mu, 0,0,0) - sigmax*vx;
  OPS_ACC(dy, 4,0,0,0)=(pxy+pyy+pzy)*OPS_ACC(mu, 0,0,0) - sigmay*vy;
  OPS_ACC(dy, 5,0,0,0)=(pxz+pyz+pzz)*OPS_ACC(mu, 0,0,0) - sigmaz*vz;

}


void fd3d_pml_kernel_c_wrapper(
  float *p_a0,
  float *p_a1,
  float *p_a2,
  float *p_a3,
  int *p_a4,
  int arg_idx0, int arg_idx1, int arg_idx2,
  int x_size, int y_size, int z_size) {
  #ifdef OPS_GPU
  #pragma acc parallel deviceptr(p_a0,p_a1,p_a2,p_a3)
  #pragma acc loop
  #endif
  for ( int n_z=0; n_z<z_size; n_z++ ){
    #ifdef OPS_GPU
    #pragma acc loop
    #endif
    for ( int n_y=0; n_y<y_size; n_y++ ){
      #ifdef OPS_GPU
      #pragma acc loop
      #endif
      for ( int n_x=0; n_x<x_size; n_x++ ){
        int arg_idx[] = {arg_idx0+n_x, arg_idx1+n_y, arg_idx2+n_z};
        const ptr_float ptr0 = {  p_a0 + n_x*1 + n_y*xdim0_fd3d_pml_kernel*1 + n_z*xdim0_fd3d_pml_kernel*ydim0_fd3d_pml_kernel*1, xdim0_fd3d_pml_kernel, ydim0_fd3d_pml_kernel};
        const ptr_float ptr1 = {  p_a1 + n_x*1 + n_y*xdim1_fd3d_pml_kernel*1 + n_z*xdim1_fd3d_pml_kernel*ydim1_fd3d_pml_kernel*1, xdim1_fd3d_pml_kernel, ydim1_fd3d_pml_kernel};
        #ifdef OPS_SOA
        const ptrm_float ptr2 = {  p_a2 + n_x*1 + n_y*xdim2_fd3d_pml_kernel*1 + n_z*xdim2_fd3d_pml_kernel*ydim2_fd3d_pml_kernel*1, xdim2_fd3d_pml_kernel, ydim2_fd3d_pml_kernel, zdim2_fd3d_pml_kernel};
        #else
        const ptrm_float ptr2 = {  p_a2 + n_x*1 + n_y*xdim2_fd3d_pml_kernel*1 + n_z*xdim2_fd3d_pml_kernel*ydim2_fd3d_pml_kernel*1, xdim2_fd3d_pml_kernel, ydim2_fd3d_pml_kernel, 6};
        #endif
        #ifdef OPS_SOA
        ptrm_float ptr3 = {  p_a3 + n_x*1 + n_y*xdim3_fd3d_pml_kernel*1 + n_z*xdim3_fd3d_pml_kernel*ydim3_fd3d_pml_kernel*1, xdim3_fd3d_pml_kernel, ydim3_fd3d_pml_kernel, zdim3_fd3d_pml_kernel};
        #else
        ptrm_float ptr3 = {  p_a3 + n_x*1 + n_y*xdim3_fd3d_pml_kernel*1 + n_z*xdim3_fd3d_pml_kernel*ydim3_fd3d_pml_kernel*1, xdim3_fd3d_pml_kernel, ydim3_fd3d_pml_kernel, 6};
        #endif
        fd3d_pml_kernel( ptr0, ptr1, ptr2, ptr3,
          arg_idx);
      }
    }
  }
}
